---
title: Rebrain "Bash scripting"
desctiption: Rebrain vebinar 2022-01-12
author: Roman Vavilov
date: '2022-01-12 20:18'
---

## Введение

Программа в линукс называется процессом. Выполнение процесса имеет коды завершения: 0 - успешное завершение, все что не
0 - ошибка. Посмотреть код последней выполненной команды можно посмотреть с помощью переменно `?`

```Shell
$ echo $?

$ ls -la
$ .
$ ..
$ somefilex.txt
$ echo $?
$ 1
```
Объедеинение команд выполняется с помощью `&&`

```Shell
$ ls -la && echo OK
```

Первая часть команды будет выполнена и, если код выхода будет `0`, то выполнится вторая команда. Если код выхода будет
отличаться от `0`, то выдастся ошибка и вторая часть не выполнится.

Обратная логика достигается с помощью `||`. Первая часть выполнится успешно - вторая выполняться не будет и наоборот.
Так же можно разделять множественные команды с помощью `;`. Такая запись означает - выполнить команды друг за другом вне
зависимости от статуса выполнения. Все команды выполнятся даже с ошибками.

Следующая команда выполнит исполняемый файл по его пути в операционной системе.
```Shell
$ /usr/bin/env [executable]
```

Т.е. если в файл со скриптом начинается со строчки, которая указывает путь до интерпертатора `#!/bin/bash`, можно
указать `#!/usr/bin/env bash` - это будет тоже самое, но не зависит от операционной системы, на которой этот файл
исполняется. 

# Потоки

Существуют потоки информации в линуксе и у них есть номера. Существует стандартный поток вывода, стандартный поток
ошибок и т.д. Напрмер

```Shell
$ ls -la > 1234
```

это означает "напрвить стандартный поток вывода в файл 1234 в текущем каталоге". В результате создастся файл 1234,
который бдет содержать результат выполнения команды, а в терминале ничего не отобразиться. При этом информация
перезаписывается, если файл содержал что-то ранее.

```Shell
$ ls -la >> 1234
```

Такая запись дополнит, а не перезапишет информацию в файле.

Чтобы направить стандартный поток ошибок, необходимо использовать номер этого потока

```Shell
$ awervssdfz 2> 1234
```

Интерпретатор bash вначале видит что ведется работа с потоками, если файл куда перенаправляется поток существует то
обнулить его (т.е. объем информации прировнять к 0) и затем выполнить команду. Это работает так не во всех
интерпретаторах.

```Shell
$ tail 1234 > 1234
```
Если файл 1234 содержал какаую-то информацию, то в результате выполнения этой команды файл станет пустым, т.к. внаячале
обнуляется файл, а зетам выполняется tail на пустом файле.

не все команды линукс имеют станадртный поток ввода, например команда ls не имеет его. Нельзя направить что-то на
стандартный поток ввода ls.

## Piping

перенаправление стандартного потока вывода левой команды в стандартный поток ввода правой команды

```Shell
$ ls -la /etc | less
```

Это называется неименованный канал. Оператор читается как pipe.

## создание файлов и наполнение содержимым

Создаем директории через ряд значений

```Shell
$ mkdir -p {01..03}/{1..5}
```

Создаем файлы через ряд значений

```Shell
$ touch {01..03}/{1..5}/file{1..2}.txt
```

Циклвы в bash

```Shell
$ for i in {01..03}; do echo $i; done
```

Вложенные циклы

```Shell
$ for i in {01..03}; do for j in {1..5}; do echo $i; echo $j; done; done
```

Создает и наполняет файлы содержимым в циклах

```Shell
$ for i in {01..03}; do for j in {1..5}; do mkdir -p $i/$j; echo file$j.txt > $i/$j/file$j.txt; done; done
```

